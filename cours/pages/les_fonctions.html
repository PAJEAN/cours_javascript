<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Le JavaScript</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="wrapper">
        <div class="page" id="page">
            <div id="header-container">Les fonctions</div>

            <p>
                Une fonction est un <b>ensemble d'instructions r√©utilisables</b> pouvant √™tre effectu√©es √† partir de param√®tres et pouvant retourner un r√©sultat. L'int√©r√™t d'une fonction est de d√©crire une proc√©dure que l'on peut utiliser autant de fois que l'on veut sans r√©√©crire les m√™mes lignes de code.
            </p>


            <!-- ----------------------------------------------------------------------- -->
            <!--                            Fonctions nomm√©es                            -->
            <!-- ----------------------------------------------------------------------- -->

            <h2> Fonctions nomm√©es </h2>

            <div id="cells25"></div>

            <div id="cells26"></div>

            <div id="cells27"></div>

            <div id="cells28"></div>

            <div id="cells29"></div>

            <div id="cells29-1"></div>

            <div class="nota-bene-box">
                <div class="nota-bene-header">
                    <span class="box-icon">üìù</span>
                    <span class="box-title">√Ä savoir</span>
                </div>
                <div class="box-content">
                    <p>
                        En JavaScript, les arguments de fonction sont toujours pass√©s par valeur : pour les types primitifs, c'est la valeur elle-m√™me qui est copi√©e, tandis que pour les objets, c'est la r√©f√©rence qui est copi√©e, ce qui permet de modifier l'objet point√© mais pas de r√©assigner la variable d'origine.
                    </p>
                </div>
            </div>
            
            <p>
                Une fonction peut √™tre d√©clar√©e avec un nombre ind√©fini de param√®tres en entr√©e. La syntaxe utilise trois points plac√©s devant le dernier param√®tre (affectation par d√©composition). Ces trois points (...) sont appel√©s <b>syntaxe de d√©composition</b>. Ils permettent d'√©tendre un it√©rable (par exemple une expression de tableau ou une cha√Æne de caract√®res) en lieu et place de plusieurs arguments (pour les appels de fonctions) ou de plusieurs √©l√©ments (pour les tableaux).
            </p>

            <div id="cells30"></div>

            <div class="nota-bene-box">
                <div class="nota-bene-header">
                    <span class="box-icon">üìù</span>
                    <span class="box-title">√Ä savoir</span>
                </div>
                <div class="box-content">
                    <p>
                        L'objet <code>arguments</code> est une variable locale (intrins√®que et inh√©rente aux fonctions) disponibles dans toutes les fonctions (qui ne sont pas des fonctions fl√©ch√©es). Cet objet est semblable √† un tableau, il poss√®de une propri√©t√© <i>length</i>, mais il n'h√©rite pas des m√©thodes de l'objet <code>Array</code> (<i>e.g.</i> <code>map()</code>, <code>every()</code>, etc.).
                    </p>
                </div>
            </div>


            <!-- ----------------------------------------------------------------------- -->
            <!--                           Fonctions anonymes                            -->
            <!-- ----------------------------------------------------------------------- -->

            <h2> Fonctions anonymes </h2>

            <p>
                Dans certain cas, il n'est pas utile de nommer une fonction qui ne sera pas appel√©e et r√©utilis√©e ailleurs dans le code. On peut donc d√©clarer des fonctions anonymes (qui n'ont pas de nom). L'exemple suivant exploite la fonction <code>every()</code> qui teste l'ensemble des √©l√©ments d'un tableau pour v√©rifier si la condition d√©crite par une fonction pass√©e en argument est respect√©e.
            </p>

            <div id="cells31"></div>

            <p>
                La d√©finition d'une fonction anonyme peut √©galement √™tre r√©alis√©e par l'interm√©diaire du mot-cl√© <code>function</code> sans renseigner de nom de fonction ou bien par la syntaxe des <b>fonctions fl√©ch√©es</b>.
            </p>

            <p>
                Une diff√©rence importante √† souligner entre les fonctions nomm√©es et les expressions de fonction (anonymes) r√©side dans leur comportement vis-√†-vis du ph√©nom√®ne de <i>hissage</i>.
            </p>
            
            <div id="cells32"></div>

            <div id="cells33"></div>


            <!-- ----------------------------------------------------------------------- -->
            <!--                           Fonctions fl√©ch√©es                            -->
            <!-- ----------------------------------------------------------------------- -->

            <h2> Fonctions fl√©ch√©es </h2>

            <p>
                Deux facteurs sont √† l'origine de la conception des fonctions fl√©ch√©es : une <b>syntaxe plus courte</b> vis-√†-vis des expressions de fonction et l'<b>absence de <code>this</code></b> sp√©cifique √† la fonction. Sur ce dernier point, cela signifie qu'une fonction fl√©ch√©e ne lie pas son propre <code>this</code> au sein de la fonction.
            </p>

            <div id="cells34"></div>


            <!-- ----------------------------------------------------------------------- -->
            <!--                        Fonctions auto-ex√©cut√©es                         -->
            <!-- ----------------------------------------------------------------------- -->

            <h2> Fonctions auto-ex√©cut√©es </h2>

            <p>
                JavaScript introduit une syntaxe pour ex√©cuter une fonction imm√©diatement apr√®s sa cr√©ation.
            </p>

            <div id="cells35"></div>


            <!-- ----------------------------------------------------------------------- -->
            <!--                         Manipuler les fonctions                         -->
            <!-- ----------------------------------------------------------------------- -->

            <h2> Manipuler les fonctions </h2>

            <h3> Fonction de premi√®re classe </h3>

            <p>
                Une fonction de <b>premi√®re classe</b> correspond √† une <b>propri√©t√© d'un langage</b> comme le JavaScript dans lequel les fonctions sont des objets de premi√®re classe. Cela signifie qu'une fonction peut :
            </p>

            <ul>
                <li> √™tre affect√©e √† des variables ou des structures de donn√©es (<i>e.g.</i> on r√©f√©rence une fonction √† une variable), </li>
                <li> √™tre pass√©e comme param√®tre √† une fonction, </li>
                <li> √™tre retourn√©e par une fonction. </li>
            </ul>

            <div id="cells36"></div>

            <h3> Fonctions d'ordre sup√©rieur </h3>

            <p>
                Cette propri√©t√© des fonctions de premi√®re classe permet des constructions int√©ressantes appel√©e <b>les fonctions d'ordre sup√©rieur</b> (<i>high order functions</i>). Une fonction d'ordre sup√©rieur est une <b>fonction qui accepte au moins une autre fonction en param√®tre, et/ou qui retourne une fonction en r√©sultat</b>. Un exemple a √©t√© pr√©sent√© pr√©c√©demment avec la fonction <code>every()</code>.
            </p>

            <div id="cells37"></div>

            <h3> Fonctions imbriqu√©es et fermetures (<i>closures</i>) </h3>

            <p>
                Il est possible d'imbriquer une fonction au sein du corps d'une autre fonction. La fonction imbriqu√©e (interne) est priv√©e par rapport √† la fonction (externe) qui la contient. Cela forme ce qu'on appelle une <b>fermeture</b> (ou <i>closure</i> en anglais).
            </p>

            <p>
                Les fermetures sont des <b>fonctions qui se "souviennent" de l'environnement dans lequel elles ont √©t√© cr√©√©es</b> (on dit aussi que la fonction capture son "environnement"). En d'autres termes, une <i>closure</i> est une fonction capable de capter des donn√©es (susceptibles de changer au cours du temps), de les enregistrer dans son espace fonctionnel et de les fournir en cas de besoin.
            </p>

            <div class="nota-bene-box">
                <div class="nota-bene-header">
                    <span class="box-icon">üìù</span>
                    <span class="box-title">√Ä savoir</span>
                </div>
                <div class="box-content">
                    <ul>
                        <li> On ne peut acc√©der √† la fonction interne seulement avec des instructions contenues dans la fonction externe. </li>
                        <li> La fonction interne est une fermeture : la fonction interne peut utiliser les arguments et des variables de la fonction externe alors que la fonction externe ne peut pas utiliser de variables et d'arguments de la fonction interne. </li>
                    </ul>
                </div>
            </div>            

            <div id="cells38"></div>

            <div id="cells39"></div>

            <p>
                Lorsque deux arguments ou variables appartenant aux port√©es d'une fermeture ont le m√™me nom, il y a un conflit de noms. La <b>port√©e la plus interne l'emportera</b> par rapport √† la port√©e la plus externe. C'est ce qu'on appelle la cha√Æne de port√©e (<i>scope chain</i> en anglais). Le premier maillon de cette cha√Æne est la port√©e la plus interne tandis que le dernier maillon est repr√©sent√© par la port√©e la plus externe.
            </p>

            <div id="cells40"></div>
            
            <div id="cells41"></div>

        </div>
    </div>


<!--
88888888888                              888          888            
    888                                  888          888            
    888                                  888          888            
    888   .d88b.  88888b.d88b.  88888b.  888  8888b.  888888 .d88b.  
    888  d8P  Y8b 888 "888 "88b 888 "88b 888     "88b 888   d8P  Y8b 
    888  88888888 888  888  888 888  888 888 .d888888 888   88888888 
    888  Y8b.     888  888  888 888 d88P 888 888  888 Y88b. Y8b.     
    888   "Y8888  888  888  888 88888P"  888 "Y888888  "Y888 "Y8888  
                                888                                  
                                888                                  
                                888                                  
-->

    <div id="template-container"></div>


<!--
 .d8888b.                   d8b          888    
d88P  Y88b                  Y8P          888    
Y88b.                                    888    
 "Y888b.    .d8888b 888d888 888 88888b.  888888 
    "Y88b. d88P"    888P"   888 888 "88b 888    
      "888 888      888     888 888  888 888    
Y88b  d88P Y88b.    888     888 888 d88P Y88b.  
 "Y8888P"   "Y8888P 888     888 88888P"   "Y888 
                                888             
                                888             
                                888             
-->

    <script src="../js/main.js"></script>

    <script>
        /* ==== Add cells ==== */

addCell('cells25', 'D√©clarer et ex√©cuter une fonction nomm√©e', `
function direBonjour() {
    console.log('Bonjour !');
}
direBonjour();
`);
        
addCell('cells26', 'Param√®tre de fonction (1/2)', `
function direBonjour(nom){
    return 'Bonjour ' + nom + '!';
}
console.log(direBonjour('Arthur'));
`);

addCell('cells27', 'Param√®tre de fonction (2/2)', `
function direBonjour(nom) {
    console.log('Bonjour ' + nom + '!');
}

/* == Est ce que JavaScript va renvoyer une erreur ? == */

direBonjour();
`);

addCell('cells28', 'Param√®tre par d√©faut', `
function direBonjour(nom, age = 32) { // Param√®tre par d√©faut.
    return 'Bonjour ' + nom + ', tu as ' + age + ' ans!';
}
console.log(direBonjour('Arthur'));
console.log(direBonjour('Merlin', 884));
`);

addCell('cells29', 'Fonction et port√©e des variables', `
var age = 22; // Variable globale.

function direBonjour(nom, age){
    var citation = 'Pas changer assiette pour fromage !'; // Variable locale.
    age++;
    return 'Bonjour ' + nom + ', tu as ' + age + ' ans! ' + citation;
}

console.log(direBonjour('Arthur', age));

/* == Quelle valeur a la variable globale age ? == */

console.log('Variable globale age =', age);

/* == Selon vous, est ce que je peux afficher la variable citation ? == */

console.log(citation);
`);

addCell('cells29-1', 'Copie par r√©f√©rence', `
function modifie(obj) {
    obj.val = 42;     // Modifie l'objet point√©.
    obj = { val: 99 }; // R√©affecte la r√©f√©rence locale.
}

let o = { val: 10 };
modifie(o);
console.log(o);
`);


addCell('cells30', 'D√©composition', `
function direBonjour(nom, ...noms) {
    console.log('Param√®tre 1 :', nom)

    for(let i = 0; i < noms.length; i++) {
        console.log(noms[i]);
    }
    console.log('---');
    for(let i = 0; i < arguments.length; i++) {
        console.log(arguments[i]);
    }
}
direBonjour('Arthur', 'Merlin', 'Perceval');
`);

addCell('cells31', 'Fonctions anonymes', `
var tableau1 = [0, 2, 4, 6, 8];

/* == Que recherchons nous √† tester ici ? == */

var response1 = tableau1.every(function(valeur){
    return (valeur % 2 == 0);
});

console.log(response1);
`);

addCell('cells32', 'Ph√©nom√®ne de hissage (1/2)', `
bonjour();
function bonjour() { // Ph√©nom√®ne de hissage.
    console.log('Bonjour !');
}
`);
        
addCell('cells33', 'Ph√©nom√®ne de hissage (2/2)', `
console.log(bonjour); // Hissage de la d√©claration et non de son initialisation.
bonjour();
var bonjour = function() {
    console.log('Bonjour !');
}
`);

addCell('cells34', 'Fonctions fl√©ch√©es', `
var tableau1 = [0, 2, 4, 6, 8];

console.log(tableau1.every((valeur) => (valeur % 2 == 0)));

console.log(tableau1.every(valeur => {
    return valeur % 2 == 0
}));
`);

addCell('cells35', "Syntaxe d'une fonctions auto-ex√©cut√©es", `
// Fonction anonyme.
(function(valeur){
    console.log(valeur % 2);
})(3);

// Fonction fl√©ch√©e.
((valeur) => {
    console.log(valeur % 2);
})(3);

// Fonction nomm√©e.
(function nom_fonction(valeur){
    console.log(valeur % 2);
})(3);
`);

addCell('cells36', 'Objet <code>Function</code>', `
let ma_fonction = () => 3;
console.log('ma_fonction instanceof Function :', ma_fonction instanceof Function);
let mon_tableau = [1, 2];
console.log('mon_tableau instanceof Array :', mon_tableau instanceof Array);
`);

addCell('cells37', "Fonction d'ordre sup√©rieur", `
function multiplierParDeux(nombre) {
    return nombre * 2;
}

function afficher(nombre) {
    console.log('La fonction afficher() affiche la valeur :', nombre);
    return nombre;
}

// Une fonction f() exploite le retour d'une fonction g().
function compose(f, g) { // Prend deux fonctions en entr√©e.
    return (nombre) => { // Renvoie une fonction en sortie.
        return f(g(nombre));
    };
}

let ma_fonction = compose(afficher, multiplierParDeux);
ma_fonction(6);
`);

addCell('cells38', '<i>Closure</i> (1/2)', `
function ajouteCarres(a, b) {
   function carre(x) { // La fonction interne est une closure.
      return x * x;
   }
   return carre(a) + carre(b);
}

let a = ajouteCarres(1, 2);
let b = ajouteCarres(3, 4);
let c = ajouteCarres(5, 6);

console.log(a + "; "+ b + "; " + c);
`);

addCell('cells39', '<i>Closure</i> (2/2)', `
// D√©finition des arguments pour la fonction externe, utilis√©s aussi pour la fonction interne.
function addition(nombre1){
    return function(nombre2){
        return nombre1 + nombre2; // nombre1 est captur√© dans l'environnement de la fonction retourn√©e.
    }
}

let additionBase10 = addition(10);
console.log(additionBase10(5));
// Ou.
console.log(addition(3)(4));
`);

addCell('cells40', 'Cha√Æne de port√©e', `
/* == D'apr√®s vous, que retournera la variable "resultat" ? == */

function externe() {
    var x = 10;
    function interne(x) {
        return x;
    }
    return interne; // On retourne la fonction interne pour pouvoir l'ex√©cuter.
}

var resultat = externe()(20);
console.log(resultat);
`);

addCell('cells41', 'Question', `
/* == D'apr√®s vous, que retournera la variable "resultat" ? == */

function externe() {
    function interne(x) {
        return function(y){
            return x * 2 + y;
        };
    }
    return interne;
}

let resultat = externe()(20);
console.log(resultat(5));
`);


/*        
        addCell('cells00', '', `

        `);
*/

    </script>
</body>
</html>