<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Le JavaScript</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="wrapper">
        <div class="page" id="page">
            <div id="header-container">L'intéractivité</div>
            
            <h2> Les évènements </h2>

            <p>
                Le JavaScript est un langage événementiel, c'est-à-dire qu'il détecte les événements qui surviennent sur la page, y réagit et déclenche de nouveaux traitements. Un événement est un changement d'état qui survient sur la page (mouvements de souris, clic sur un élément, chargement d'un élément de la page, <i>etc.</i>).
            </p>

            <div style="width:100%;text-align:center;">
                <img src="../../images/javascript-events.png" alt="Événements" style="border-radius: 15px"/>
                <div style="margin:auto">Source: <a href="https://openclassrooms.com/fr/courses/1916641-dynamisez-vos-sites-web-avec-javascript/1918968-les-evenements">openclassrooms</a>.</div>
            </div>

            <h2> La détection dans le code HTML </h2>

<textarea class="editor" spellcheck="false">
<button onclick="alert('Pas changer assiette pour fromage !');"> ARTHOUUUUR </button>
<button onclick="compteur++; alert(compteur);"> Je sais compter </button>
<button id="button3" onclick="colorChange();"> Poème </button>

<script type="text/javascript">
    var compteur = 0;
    function colorChange(){
        color = document.getElementById("button3").style.color;
        switch(color){
            case "red":
                document.getElementById("button3").style.color = "blue";
                document.getElementById("button3").innerHTML = "Violets are blue";
                break;
            case "blue":
                document.getElementById("button3").style.color = "red";
                document.getElementById("button3").innerHTML = "Roses are red";
                break;
            default:
                document.getElementById("button3").style.color = "red";
                document.getElementById("button3").innerHTML = "Roses are red";
        }
    }
</script></textarea>

            <button onclick="alert('Pas changer assiette pour fromage !');"> ARTHOUUUUR </button>
            <button onclick="compteur++; alert(compteur);"> Je sais compter </button>
            <button id="button3" onclick="colorChange2();"> Poème </button>
            
            <script type="text/javascript">
                var compteur = 0;
                function colorChange2(){
                    color = document.getElementById("button3").style.color;
                    switch(color){
                        case "red":
                            document.getElementById("button3").style.color = "blue";
                            document.getElementById("button3").innerHTML = "Violets are blue";
                            break;
                        case "blue":
                            document.getElementById("button3").style.color = "red";
                            document.getElementById("button3").innerHTML = "Roses are red";
                            break;
                        default:
                            document.getElementById("button3").style.color = "red";
                            document.getElementById("button3").innerHTML = "Roses are red";
                    }
                }
            </script>

            <p>
                Cette manière de déclarer des événements par attribut est rapide mais présente l'inconvénient de mélanger le traitement JavaScript à la mise en forme des données via HTML.
            </p>

            <h2> La détection par le gestionnaire d'événements </h2>

            <p>
                Le gestionnaire d'événements permet de centraliser la déclaration des événements dans un bloc JavaScript sans modifier le code HTML gardant ainsi la séparation entre traitements et données.
            </p>

            <p>
                <b><code>target.addEventListener(String myEvent, Function toDo, [options]);</code></b>
            </p>

            <ul>
                <li> <i>target</i> : correspond à l'élément ciblé dans le code HTML. </li>
                <li> <i>myEvent</i> : le type d'événement à détecter. </li>
                <li> <i>toDo</i> : une fonction qui reçoit en paramètre l'objet de type <code>Event</code> détecté. </li>
                <li> Le paramètre facultatif <i>options</i> spécifie les caractéristiques de l'écouteur d'évènements (<i>e.g.</i> <code>{"once": true}</code> supprime automatiquement le <i>listener</i> après son premier appel. </li>
            </ul>

<textarea class="editor" spellcheck="false">
<button id="button1"> Poème </button>
    
<script type="text/javascript">
    function colorChange(evt) {
        let color = evt.currentTarget.style.color;
        switch(color){
        case "red":
            evt.currentTarget.style.color = "blue";
            evt.currentTarget.innerHTML = "Violets are blue";
            break;
        case "blue":
            evt.currentTarget.style.color = "red";
            evt.currentTarget.innerHTML = "Roses are red";
            break;
        default:
            evt.currentTarget.style.color = "red";
            evt.currentTarget.innerHTML = "Roses are red";
        }
        var button1 = document.getElementById("button1");
        button1.addEventListener("click", colorChange); // {"once": true}
    }
</script></textarea>

            <button id="button1"> Poème </button>
    
            <script type="text/javascript">
                function colorChange(evt) {
                    let color = evt.currentTarget.style.color;
                    switch(color){
                    case "red":
                        evt.currentTarget.style.color = "blue";
                        evt.currentTarget.innerHTML = "Violets are blue";
                        break;
                    case "blue":
                        evt.currentTarget.style.color = "red";
                        evt.currentTarget.innerHTML = "Roses are red";
                        break;
                    default:
                        evt.currentTarget.style.color = "red";
                        evt.currentTarget.innerHTML = "Roses are red";
                    }
                }
                var button1 = document.getElementById("button1");
                button1.addEventListener("click", colorChange); // {"once": true}
            </script>

            <p>
                La fonction <code>colorChange()</code> reçoit en paramètre <code>evt</code> un objet de type <code>Event</code>. Un objet <code>Event</code> contient deux propriétés de cible. La propriété <code>currentTarget</code> référence l'objet sur lequel l'événement a été attaché et la propriété <code>target</code> référence l'objet sur lequel l'événement s'est produit.
            </p>

<textarea class="editor" spellcheck="false">
<ul id="ul1">
    <li> Arthur </li>
    <li> Perceval </li>
    <li> Merlin </li>
</ul>

<div id="maDiv"> Cliquez sur un nom! </div>

<script type="text/javascript">
    var ul1 = document.getElementById('ul1');
    ul1.addEventListener('click', direBonjour);
    function direBonjour(evt){
        if(evt.target.nodeName == 'LI') { // Évite de considérer UL dans le retour.
            document.getElementById('maDiv').innerHTML = 'Bonjour ' + evt.target.innerHTML +
                ' (' + (evt.currentTarget.id) + ') !';
        }
    }
</script></textarea>
            
            <ul id="ul1" style="cursor: pointer;">
                <li> Arthur </li>
                <li> Perceval </li>
                <li> Merlin </li>
            </ul>
            
            <div id="maDiv"> <b>Cliquez sur un nom ci-dessus!</b> </div>
            
            <script type="text/javascript">
                var ul1 = document.getElementById("ul1");
                ul1.addEventListener("click", direBonjour);
                function direBonjour(evt) {
                    if(evt.target.nodeName == "LI"){ // Évite de considérer UL dans le retour.
                        document.getElementById("maDiv").innerHTML = "Bonjour " + evt.target.innerHTML +
                            " (" + (evt.currentTarget.id) + ") !";
                    }
                }
            </script>

            <p>
                La fonction <b><code>target.removeEventListener(String myEvent, Function toDo, [options]);</code></b> permet de supprimer l'événement de type <code>myEvent</code> associé à la fonction <code>toDo</code>.
            </p>

            <h2> La manipulation du document </h2>

            <h3> Le DOM </h3>

            <p>
                Le DOM (<i>Document Object Model</i>) est une organisation hiérarchisée en arborescence de l'ensemble des éléments du document. Chaque élément forme un noeud (<code>node</code>) dans le document.
            </p>

            <p>
                L'objet <code>document</code> représente la page HTML chargée dans le navigateur. Il constitue l'objet racine du DOM et permet d'accéder à l'ensemble des éléments de la page, ainsi que de les rechercher, les manipuler et d'en créer de nouveaux.
            </p>

            <div style="width:100%;text-align:center;">
                <img src="../../images/pic_htmltree.gif" alt="DOM" style="border-radius: 15px"/>
                <div style="margin:auto">Source: <a href="https://www.w3schools.com/js/js_htmldom_navigation.asp">W3Schools</a>.</div>
            </div>

            <h3> Trouver les éléments du document </h3>

            <p>
                Il existe plusieurs méthodes permettant de rechercher des éléments au sein du DOM qui se basent sur la nature des balises ou de leurs attributs.
            </p>

            <li> <code>getElementById(String param)</code> retourne le premier élément HTML du DOM ayant l'attribut <i>id</i> passé en paramètre. </li>
            <li> <code>getElementsByClassName(String param)</code> retourne une liste d'éléments dont la classe CSS correspond au nom de classe passé en paramètre. </li>
            <li> <code>getElementsByTagName(String param)</code> retourne une liste d'éléments dont la balise correspond à la balise passée en paramètre. </li>
            <li> <code>getElementsByName(String param)</code> retourne une liste  d'éléments dont l'attribut <i>name</i> correspond au nom passé en paramètre (l'attibut <i>name</i> est généralement utilisé pour envoyer des données côté serveur par l'intermédiaire d'un formulaire). </li>
            <li> <code>querySelectorAll(String param)</code> retourne tous les éléments trouvés dans le DOM répondant au sélecteur CSS (la notation CSS pour accéder aux éléments) passé en paramètre. Cette méthode permet notamment de réaliser des requêtes plus précises par rapport à <code>getElementsByClassName()</code>. </li>
            <li> <code>querySelector(String param)</code> retourne le premier élément trouvé dans le DOM répondant au sélecteur CSS passé en paramètre. </li>

            <div class="nota-bene-box">
                <div class="nota-bene-header">
                    <span class="box-icon">📝</span>
                    <span class="box-title">À savoir</span>
                </div>
                <div class="box-content">
                    Les fonctions ci-dessus retournent des éléments de type <i>HTMLCollection</i> ou de type <i>NodeList</i>. Ces types <b>n'héritent pas</b> du type <i>Array</i> et des méthodes attachées <i>e.g. map()</i>.
                </div>
            </div>

            <p>
                Voir <a href="../../exemples/dom/manipulation.html"> l'exemple</a>.
            </p>

            <h3> Créer de nouveaux éléments </h3>

            <p>
                JavaScript permet de créer, d'ajouter ou bien de supprimer des éléments HTML.
            </p>

            <h4> La méthode <code>createElement()</code> </h4>

            <p>
                La création d'un nouvel élément est réalisée avec la méthode <code>document.createElement(String typeElement)</code>. Le paramètre <i>typeElement</i> est une chaîne désignant la balise de l'élément à créer.
            </p>

<textarea class="editor" spellcheck="false">
var new_div = document.createElement("div");
new_div.innerHTML = "Je suis une nouvelle div.";</textarea>

            <h4> Ajouter des éléments dans le document </h4>

            <p>
                À ce moment, la <code>div</code> n'est pas encore sur le document. Il n'est qu'un objet JavaScript en mémoire. La seconde étape est de l'ajouter à l'endroit voulu au sein du DOM. La méthodes <b><code>parent.appendChild(HTMLElement enfant)</code></b> permet d'ajouter la balise à l'élément <code>parent</code>.
            </p>

            <h4> Supprimer un élément HTML </h4>

            <p>
                La méthode <code>removeChild()</code> retire du DOM l'élement enfant de son élément parent. Voir <a href="../../exemples/dom/elements.html">l'exemple</a>.
            </p>

            <h3> Accéder aux attributs </h3>

            <h4> Les attributs simples </h4>

            <p>
                Le JavaScript dispose de méthodes pour accéder aux attributs d'un élément HTML.
            </p>

            <ul>
                <li> <code>hasAttribute(String nomAttribut)</code> retourne <code>true</code> si l'attribut passé en paramètre est présent dans la balise. </li>
                <li> <code>getAttribute(String nomAttribut)</code> retourne le contenu de l'attribut passé en paramètre. </li>
                <li> <code>setAttribute(String nomAttribut, String valeur)</code> modifie le contenu d'un attribut. </li>
            </ul>

            <div class="exercise-box">
                <div class="exercise-header">
                    <span class="box-icon">💡</span>
                    <span class="box-title">Exercice</span>
                </div>
                <div class="box-content">
                    <p> À partir de la balise suivante <code>&lt;div id="mydiv">My div.&lt;/div></code> vérifier si l'attribut <i>id</i> est bien présent et modifier sa valeur par <i>mynewdiv</i>. </p>
                </div>
            </div>

            <button class="btn toggle-answer" data-pw="av">
                Afficher la réponse
            </button>
            <div class="hidden">
<textarea class="editor mt" spellcheck="false">
let all_div = document.querySelectorAll('div');
all_div.forEach(div => {
    if (div.hasAttribute('id') && div.getAttribute('id') == 'mydiv') {
        div.id = 'mynewdiv';        
    }
});</textarea>                
            </div>

            <h4> Les attributs de données </h4>

            <p>
                La norme HTML du W3C définit strictement les attributs et les noms autorisés par balise. Cependant, il est possible de stocker directement dans le DOM des données via des attributs. Pour respecter la norme HTML, les noms des attributs doivent commencer par <code>data-</code> suivi d'un nom au choix (c'est une convention). Par exemple, il est possible de créer la balise <code>&lt;div data-clics="0">Nombre de clics&lt;/div></code>.
            </p>

            <div class="exercise-box">
                <div class="exercise-header">
                    <span class="box-icon">💡</span>
                    <span class="box-title">Exercice</span>
                </div>
                <div class="box-content">
                    <p> À partir de la balise suivante <i>&lt;div id="mydiv">Cliquer.&lt;/div></i> ajouter l'attribut de données <i>data-clics</i> et <i>data-last-clics</i> qui permet respectivement de stocker le nombre de fois où l'utilisateur a cliqué sur la balise et la date de son dernier clic. Vous pouvez utiliser la méthode <i>new Date().getTime()</i> (= nombre de millisecondes écoulées depuis le 1er janvier 1970). </p>
                </div>
            </div>

            <button class="btn toggle-answer" data-pw="ar">
                Afficher la réponse
            </button>
            <div class="hidden">
                <div id="cells1"></div>
            </div>

            <div class="exercise-box">
                <div class="exercise-header">
                    <span class="box-icon">💡</span>
                    <span class="box-title">Exercice</span>
                </div>
                <div class="box-content">
                    <p> Rendez-vous au lien suivant: <b>https://github.com/PAJEAN/cours_javascript/tree/master/exemples/bst</b> pour réaliser le TP sur l'arbre binaire de recherche (BST). </p>
                </div>
            </div>

            <button class="btn toggle-answer" data-pw="rt">
                Afficher la réponse
            </button>
            <div class="hidden">

                <p> Fichier HTML.</p>

<textarea class="editor mt" spellcheck="false">
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>BST</title>
	</head>
	<body>
		<table>
			<tr><td>Minimum</td><td id="minimum"></td></tr>
			<tr><td>Maximum</td><td id="maximum"></td></tr>
		</table>
		<div>
			<input type="text" id="add">
			<button id="add-button">Ajouter</button>
		</div>
        
		<!-- <div>
			<input type="text" id="erase">
			<button id="erase-button">Effacer</button>
		</div> -->

		<div id="graph"></div>

		<script src="viz.js"></script>
		<script src="full.render.js"></script>
		<script src="BST.js"></script>
	</body>
</html></textarea>

                <p> Fichier JavaScript.</p>

<textarea class="editor mt" spellcheck="false">
class Node{
    constructor(data, left = null, right = null) {
        this.data = data;
        this.left = left;
        this.right = right;
    }
}

class BST{
    constructor(){
        this.root = null;
        this.parents = {};
        this.nodes = {};
    }
    
    /* Convert the adjacency matrix to dot language in order to use viz.js */
    _toDotLanguage() {
        let graph = [];

        if (this.root.left == null && this.root.right == null) {
            graph.push(this.root.data);
            return `digraph { ${graph.join(' ')} }`;
        }

        let queue = [this.root];
        while (queue.length > 0) {
            let current_node = queue.pop();
            if (current_node.left != null) {
                graph.push(`${current_node.data} -> ${current_node.left.data}`);
                queue.push(current_node.left);
            }
            if (current_node.right != null) {
                graph.push(`${current_node.data} -> ${current_node.right.data}`);
                queue.push(current_node.right);
            }
        }
        return `digraph { ${graph.join(' ')} }`;
    }

    add(data) {
        if (this.root == null) {
            this.root = new Node(data);
            return;
        }
        let queue = [this.root];
        while (queue.length > 0) {
            let current_node = queue.pop();
            if (data < current_node.data) {
                if (current_node.left == null) {
                    this.nodes[data] = new Node(data);
                    current_node.left = this.nodes[data];
                    this.parents[data] = current_node.data;
                    return;
                }
                queue.push(current_node.left);
            } else if (data > current_node.data) {
                if (current_node.right == null) {
                    this.nodes[data] = new Node(data);
                    current_node.right = this.nodes[data];
                    this.parents[data] = current_node.data;
                    return;
                }
                queue.push(current_node.right);
            }
        }
    }

    findMin(root_node = this.root) {
        if (this.root == null) { return ''; }

        let queue = [root_node];
        while (queue.length > 0) {
            let current_node = queue.pop();
            if (current_node.left == null) {                            
                return current_node.data;
            }
            queue.push(current_node.left);
        }
    }

    findMax(root_node = this.root) {
        if (this.root == null) { return ''; }
        
        let queue = [root_node];
        while (queue.length > 0) {
            let current_node = queue.pop();
            if (current_node.right == null) {
                return current_node.data;
            }
            queue.push(current_node.right);
        }
    }

    remove(data) {
        this.root = this._removeNode(this.root, data);
    }

    _removeNode(node, data) {
        console.log('----------------');                    
        if (node == null) return null;

        if (data < node.data) {
            node.left = this._removeNode(node.left, data);
            return node;
        } else if (data > node.data) {
            node.right = this._removeNode(node.right, data);
            return node;
        } else {
            // Cas 1 : feuille
            if (node.left === null && node.right === null) {
                return null;
            }

            // Cas 2 : un seul enfant
            if (node.left === null) return node.right;
            if (node.right === null) return node.left;

            // Cas 3 : deux enfants
            // → On cherche le plus petit élément du sous-arbre droit (successeur)
            let minRight = node.right;
            while (minRight.left !== null) {
                minRight = minRight.left;
            }
            node.data = minRight.data;
            node.right = this._removeNode(node.right, minRight.data);
            return node;
        }
    }

    update(){
        let minimum = document.querySelector('#minimum');
        let maximum = document.querySelector('#maximum');
        minimum.textContent = this.findMin();
        maximum.textContent = this.findMax();
    }

    display() {
        let graph_tag = document.querySelector('#graph');
        graph_tag.textContent = '';                    

        if (this.root == null) { return; }

        let viz = new Viz();
        viz.renderSVGElement(this._toDotLanguage())
        .then(function(element) {
            graph_tag.appendChild(element);
        })
        .catch(error => {
            // Possibly display the error
            console.error(error);
        });
    }
}


let bst = new BST();
bst.add(12);
bst.add(14);
bst.add(13);
bst.add(15);
bst.display();

let add_btn = document.querySelector('#add-button');
let add_input = document.querySelector('#add');
add_btn.addEventListener('click', evt => {
    if (isNaN(Number(add_input.value))) return;
    bst.add(Number(add_input.value));
    bst.update();
    bst.display();
    console.log('Added');
});

let erase_btn = document.querySelector('#erase-button');
let erase_input = document.querySelector('#erase');
erase_btn.addEventListener('click', evt => {
    if (isNaN(Number(erase_input.value))) return;
    bst.remove(Number(erase_input.value));
    bst.update();
    bst.display();
    console.log('Erased');
});
</textarea>
            </div>

        </div>
    </div>


<!--
88888888888                              888          888            
    888                                  888          888            
    888                                  888          888            
    888   .d88b.  88888b.d88b.  88888b.  888  8888b.  888888 .d88b.  
    888  d8P  Y8b 888 "888 "88b 888 "88b 888     "88b 888   d8P  Y8b 
    888  88888888 888  888  888 888  888 888 .d888888 888   88888888 
    888  Y8b.     888  888  888 888 d88P 888 888  888 Y88b. Y8b.     
    888   "Y8888  888  888  888 88888P"  888 "Y888888  "Y888 "Y8888  
                                888                                  
                                888                                  
                                888                                  
-->

    <div id="template-container"></div>


<!--
 .d8888b.                   d8b          888    
d88P  Y88b                  Y8P          888    
Y88b.                                    888    
 "Y888b.    .d8888b 888d888 888 88888b.  888888 
    "Y88b. d88P"    888P"   888 888 "88b 888    
      "888 888      888     888 888  888 888    
Y88b  d88P Y88b.    888     888 888 d88P Y88b.  
 "Y8888P"   "Y8888P 888     888 88888P"   "Y888 
                                888             
                                888             
                                888             
-->

    <script src="../js/main.js"></script>

    <script>
        /* ==== Add cells ==== */        
addCell('cells1', '', `
let div = document.querySelector('#mydiv');
if (div) {
    div.setAttribute('data-clics', 0);
    div.setAttribute('data-last-clics', new Date().toString());
    
    div.addEventListener('click', () => {
        div.setAttribute('data-clics', parseInt(div.getAttribute('data-clics')) + 1);
        div.setAttribute('data-last-clics', new Date().toString());
    });
} else {
    console.log('div not found');
}
`);


/*        
    addCell('cells00', '', `

    `);
*/

    </script>
</body>
</html>