<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Le JavaScript</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="wrapper">
        <div class="page" id="page">
            <header>
                <h1 class="title">L'int√©ractivit√©</h1>
                <div class="toolbar">
                    <button class="btn" id="btn-print" title="Imprimer / Exporter en PDF">üñ®Ô∏è Imprimer</button>
                    <button class="btn" id="btn-theme" title="Changer le th√®me" data-initial="light">üåó Th√®me</button>
                </div>
            </header>

            <!-- ----------------------------------------------------------------------- -->
            <!--                             L'int√©ractivit√©                             -->
            <!-- ----------------------------------------------------------------------- -->
            
            <h2> Les √©v√®nements </h2>

            <p> Le JavaScript est un langage √©v√©nementiel, c'est-√†-dire qu'il d√©tecte les √©v√©nements qui surviennent sur la page, y r√©agit et d√©clenche de nouveaux traitements. Un √©v√©nement est un changement d'√©tat qui survient sur la page (mouvements de souris, clic sur un √©l√©ment, chargement d'un √©l√©ment de la page, *etc.*). </p>

            <div style="width:100%;text-align:center;">
                <img src="../../images/javascript-events.png" alt="√âv√©nements" style="border-radius: 15px"/>
                <div style="margin:auto">Source: <a href="https://openclassrooms.com/fr/courses/1916641-dynamisez-vos-sites-web-avec-javascript/1918968-les-evenements">openclassrooms</a>.</div>
            </div>

            <h2> La d√©tection dans le code HTML </h2>

<textarea class="editor" spellcheck="false">
<button onclick="alert('Pas changer assiette pour fromage !');"> ARTHOUUUUR </button>
<button onclick="compteur++; alert(compteur);"> Je sais compter </button>
<button id="button3" onclick="colorChange();"> Po√®me </button>

<script type="text/javascript">
    var compteur = 0;
    function colorChange(){
        color = document.getElementById("button3").style.color;
        switch(color){
            case "red":
                document.getElementById("button3").style.color = "blue";
                document.getElementById("button3").innerHTML = "Violets are blue";
                break;
            case "blue":
                document.getElementById("button3").style.color = "red";
                document.getElementById("button3").innerHTML = "Roses are red";
                break;
            default:
                document.getElementById("button3").style.color = "red";
                document.getElementById("button3").innerHTML = "Roses are red";
        }
    }
</script></textarea>

            <button onclick="alert('Pas changer assiette pour fromage !');"> ARTHOUUUUR </button>
            <button onclick="compteur++; alert(compteur);"> Je sais compter </button>
            <button id="button3" onclick="colorChange();"> Po√®me </button>
            
            <script type="text/javascript">
                var compteur = 0;
                function colorChange(){
                    color = document.getElementById("button3").style.color;
                    switch(color){
                        case "red":
                            document.getElementById("button3").style.color = "blue";
                            document.getElementById("button3").innerHTML = "Violets are blue";
                            break;
                        case "blue":
                            document.getElementById("button3").style.color = "red";
                            document.getElementById("button3").innerHTML = "Roses are red";
                            break;
                        default:
                            document.getElementById("button3").style.color = "red";
                            document.getElementById("button3").innerHTML = "Roses are red";
                    }
                }
            </script>

            <p> Cette mani√®re de d√©clarer des √©v√©nements par attribut est rapide mais pr√©sente l'inconv√©nient de m√©langer le traitement JavaScript √† la mise en forme des donn√©es via HTML. </p>

            <h2> La d√©tection par le gestionnaire d'√©v√©nements </h2>

            <p> Le gestionnaire d'√©v√©nements permet de centraliser la d√©claration des √©v√©nements dans un bloc JavaScript sans modifier le code HTML gardant ainsi la s√©paration entre traitements et donn√©es. </p>

            <b><code>target.addEventListener(String myEvent, Function toDo, [options]);</code></b>

            <ul>
                <li> <i>target</i> : correspond √† l'√©l√©ment cibl√© dans le code HTML. </li>
                <li> <i>myEvent</i> : le type d'√©v√©nement √† d√©tecter. </li>
                <li> <i>toDo</i> : une fonction qui re√ßoit en param√®tre l'objet de type *Event* d√©tect√©. </li>
                <li> Le param√®tre facultatif <i>options</i> sp√©cifie les caract√©ristiques de l'√©couteur d'√©v√®nements (<i>e.g.</i> <code>{"once": true}</code> supprime automatiquement le <i>listener</i> apr√®s son premier appel. </li>
            </ul>

<textarea class="editor" spellcheck="false">
<button id="button1"> Po√®me </button>
    
<script type="text/javascript">
    function colorChange(evt) {
        let color = evt.currentTarget.style.color;
        switch(color){
        case "red":
            evt.currentTarget.style.color = "blue";
            evt.currentTarget.innerHTML = "Violets are blue";
            break;
        case "blue":
            evt.currentTarget.style.color = "red";
            evt.currentTarget.innerHTML = "Roses are red";
            break;
        default:
            evt.currentTarget.style.color = "red";
            evt.currentTarget.innerHTML = "Roses are red";
        }
        var button1 = document.getElementById("button1");
        button1.addEventListener("click", colorChange); // {"once": true}
    }
</script></textarea>

            <button id="button1"> Po√®me </button>
    
            <script type="text/javascript">
                function colorChange(evt) {
                    let color = evt.currentTarget.style.color;
                    switch(color){
                    case "red":
                        evt.currentTarget.style.color = "blue";
                        evt.currentTarget.innerHTML = "Violets are blue";
                        break;
                    case "blue":
                        evt.currentTarget.style.color = "red";
                        evt.currentTarget.innerHTML = "Roses are red";
                        break;
                    default:
                        evt.currentTarget.style.color = "red";
                        evt.currentTarget.innerHTML = "Roses are red";
                    }
                }
                var button1 = document.getElementById("button1");
                button1.addEventListener("click", colorChange); // {"once": true}
            </script>

            <p> La fonction <code>colorChange()</code> re√ßoit en param√®tre <code>evt</code> un objet de type <code>Event</code>. Un objet <code>Event</code> contient deux propri√©t√©s de cible. La propri√©t√© *currentTarget* r√©f√©rence l'objet sur lequel l'√©v√©nement a √©t√© attach√© et la propri√©t√© <code>target</code> r√©f√©rence l'objet sur lequel l'√©v√©nement s'est produit. </p>

<textarea class="editor" spellcheck="false">
<ul id="ul1">
    <li> Arthur </li>
    <li> Perceval </li>
    <li> Merlin </li>
</ul>

<div id="maDiv"> Cliquez sur un nom! </div>

<script type="text/javascript">
    var ul1 = document.getElementById("ul1");
    ul1.addEventListener("click", direBonjour);
    function direBonjour(evt){
        if(evt.target.nodeName == "LI"){ // √âvite de consid√©rer UL dans le retour.
            document.getElementById("maDiv").innerHTML = "Bonjour " + evt.target.innerHTML +
                " (" + (evt.currentTarget.id) + ") !";
        }
    }
</script></textarea>
            
            <ul id="ul1" style="cursor: pointer;">
                <li> Arthur </li>
                <li> Perceval </li>
                <li> Merlin </li>
            </ul>
            
            <div id="maDiv"> <b>Cliquez sur un nom ci-dessus!</b> </div>
            
            <script type="text/javascript">
                var ul1 = document.getElementById("ul1");
                ul1.addEventListener("click", direBonjour);
                function direBonjour(evt) {
                    if(evt.target.nodeName == "LI"){ // √âvite de consid√©rer UL dans le retour.
                        document.getElementById("maDiv").innerHTML = "Bonjour " + evt.target.innerHTML +
                            " (" + (evt.currentTarget.id) + ") !";
                    }
                }
            </script>

            <p> La fonction <b><code>target.removeEventListener(String myEvent, Function toDo, [options]);</code></b> permet de supprimer l'√©v√©nement de type <code>myEvent</code> associ√© √† la fonction <code>toDo</code>. </p>

            <h2> La manipulation du document </h2>

            <h3> Le DOM </h3>

            <p> Le DOM (<i>Document Object Model</i>) est une organisation hi√©rarchis√©e en arborescence de l'ensemble des √©l√©ments du document. Chaque √©l√©ment forme un noeud (<code>node</code>) dans le document.

            <p> L'objet <code>document</code> repr√©sente la page HTML charg√©e dans le navigateur. Il constitue l'objet racine du DOM et permet d'acc√©der √† l'ensemble des √©l√©ments de la page, ainsi que de les rechercher, les manipuler et d'en cr√©er de nouveaux. </p>

            <div style="width:100%;text-align:center;">
                <img src="../../images/pic_htmltree.gif" alt="DOM" style="border-radius: 15px"/>
                <div style="margin:auto">Source: <a href="https://www.w3schools.com/js/js_htmldom_navigation.asp">W3Schools</a>.</div>
            </div>

            <h3> Trouver les √©l√©ments du document </h3>

            Il existe plusieurs m√©thodes permettant de rechercher des √©l√©ments au sein du DOM qui se basent sur la nature des balises ou de leurs attributs.

            <li> La m√©thode <code>getElementById(String param)</code> de <code>document</code> retourne le premier √©l√©ment HTML du DOM ayant l'attribut <i>id</i> pass√© en param√®tre. </li>
            <li> La m√©thode <code>getElementsByClassName(String param)</code> retourne une liste d'√©l√©ments dont la classe CSS correspond au nom de classe pass√© en param√®tre. </li>
            <li> La m√©thode <code>getElementsByTagName(String param)</code> retourne une liste d'√©l√©ments dont la balise correspond √† la balise pass√©e en param√®tre. </li>
            <li> La m√©thode <code>getElementsByName(String param)</code> retourne une liste  d'√©l√©ments dont l'attribut <i>name</i> correspond au nom pass√© en param√®tre (l'attibut <i>name</i> est g√©n√©ralement utilis√© pour envoyer des donn√©es c√¥t√© serveur par l'interm√©diaire d'un formulaire). </li>
            <li> La m√©thode <code>querySelectorAll(String param)</code> retourne tous les √©l√©ments trouv√©s dans le DOM r√©pondant au s√©lecteur CSS (la notation CSS pour acc√©der aux √©l√©ments) pass√© en param√®tre. Cette m√©thode permet notamment de r√©aliser des requ√™tes plus pr√©cises par rapport √† <code>getElementsByClassName()</code>. </li>
            <li> La m√©thode <code>querySelector(String param)</code> retourne le premier √©l√©ment trouv√© dans le DOM r√©pondant au s√©lecteur CSS pass√© en param√®tre. </li>

            <div class="nota-bene-box">
                <div class="nota-bene-header">
                    <span class="box-icon">üìù</span>
                    <span class="box-title">√Ä savoir</span>
                </div>
                <div class="box-content">
                    Les fonctions ci-dessus retournent des √©l√©ments de type <i>HTMLCollection</i> ou de type <i>NodeList</i>. Ces types <b>n'h√©ritent pas</b> du type <i>Array</i> et des m√©thodes attach√©es <i>e.g. map()</i>.
                </div>
            </div>

            <p> Voir <a href="../../exemples/dom/manipulation.html"> l'exemple</a>. </p>

            <h3> Cr√©er de nouveaux √©l√©ments </h3>

            <p> JavaScript permet de cr√©er, d'ajouter ou bien de supprimer des √©l√©ments HTML. </p>

            <h4> La m√©thode <code>createElement()</code> </h4>

            <p> La cr√©ation d'un nouvel √©l√©ment est r√©alis√©e avec la m√©thode <code>document.createElement(String typeElement)</code>. Le param√®tre <i>typeElement</i> est une cha√Æne d√©signant la balise de l'√©l√©ment √† cr√©er. </p>

<textarea class="editor" spellcheck="false">
var new_div = document.createElement("div");
new_div.innerHTML = "Je suis une nouvelle div.";</textarea>

            <h4> Ajouter des √©l√©ments dans le document </h4>

            <p> √Ä ce moment, la <code>div</code> n'est pas encore sur le document. Il n'est qu'un objet JavaScript en m√©moire. La seconde √©tape est de l'ajouter √† l'endroit voulu au sein du DOM. La m√©thodes <b><code>parent.appendChild(HTMLElement enfant)</code></b> permet d'ajouter la balise √† l'√©l√©ment <code>parent</code>. </p>

            <h4> Supprimer un √©l√©ment HTML </h4>

            <p> La m√©thode <code>removeChild()</code> retire du DOM l'√©lement enfant de son √©l√©ment parent. Voir <a href="../../exemples/dom/elements.html">l'exemple</a>. </p>

            <h3> Acc√©der aux attributs </h3>

            <h4> Les attributs simples </h4>

            <p> Le JavaScript dispose de m√©thodes pour acc√©der aux attributs d'un √©l√©ment HTML. </p>

            <ul>
                <li> La m√©thode <code>hasAttribute(String nomAttribut)</code> retourne <code>true</code> si l'attribut pass√© en param√®tre est pr√©sent dans la balise. </li>
                <li> La m√©thode <code>getAttribute(String nomAttribut)</code> retourne le contenu de l'attribut pass√© en param√®tre. </li>
                <li> La m√©thode <code>setAttribute(String nomAttribut, String valeur)</code> modifie le contenu d'un attribut. </li>
            </ul>

            <div class="exercise-box">
                <div class="exercise-header">
                    <span class="box-icon">üí°</span>
                    <span class="box-title">Exercice</span>
                </div>
                <div class="box-content">
                    <p> √Ä partir de la balise suivante <code>&lt;div id="mydiv">My div.&lt;/div></code> v√©rifier si l'attribut <i>id</i> est bien pr√©sent et modifier sa valeur par <i>mynewdiv</i>. </p>
                </div>
            </div>

            <button class="btn toggle-answer" data-pw="av">
                Afficher la r√©ponse
            </button>
            <div class="hidden">
<textarea class="editor mt" spellcheck="false">
let all_div = document.querySelectorAll('div');
all_div.forEach(div => {
    if (div.hasAttribute('id') && div.getAttribute('id') == 'mydiv') {
        div.id = 'mynewdiv';        
    }
});</textarea>                
            </div>

            <h4> Les attributs de donn√©es </h4>

            <p> La norme HTML du W3C d√©finit strictement les attributs et les noms autoris√©s par balise. Cependant, il est possible de stocker directement dans le DOM des donn√©es via des attributs. Pour respecter la norme HTML, les noms des attributs doivent commencer par <code>data-</code> suivi d'un nom au choix (c'est une convention). Par exemple, il est possible de cr√©er la balise <code>&lt;div data-clics="0">Nombre de clics&lt;/div></code>. </p>

            <div class="exercise-box">
                <div class="exercise-header">
                    <span class="box-icon">üí°</span>
                    <span class="box-title">Exercice</span>
                </div>
                <div class="box-content">
                    <p> √Ä partir de la balise suivante <i>&lt;div id="mydiv">Cliquer.&lt;/div></i> ajouter l'attribut de donn√©es <i>data-clics</i> et <i>data-last-clics</i> qui permet respectivement de stocker le nombre de fois o√π l'utilisateur a cliqu√© sur la balise et la date de son dernier clic. Vous pouvez utiliser la m√©thode <i>new Date().getTime()</i> (= nombre de millisecondes √©coul√©es depuis le 1er janvier 1970). </p>
                </div>
            </div>

            <div class="exercise-box">
                <div class="exercise-header">
                    <span class="box-icon">üí°</span>
                    <span class="box-title">Exercice</span>
                </div>
                <div class="box-content">
                    <p> Rendez-vous au lien suivant: <b>https://github.com/PAJEAN/cours_javascript/tree/master/exemples/bst</b> pour r√©aliser le TP sur l'arbre binaire de recherche (BST). </p>
                </div>
            </div>

            <button class="btn toggle-answer" data-pw="rt">
                Afficher la r√©ponse
            </button>
            <div class="hidden">

                <p> Fichier HTML.</p>

<textarea class="editor mt" spellcheck="false">
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>BST</title>
	</head>
	<body>
		<table>
			<tr><td>Minimum</td><td id="minimum"></td></tr>
			<tr><td>Maximum</td><td id="maximum"></td></tr>
		</table>
		<div>
			<input type="text" id="add">
			<button id="add-button">Ajouter</button>
		</div>
        
		<!-- <div>
			<input type="text" id="erase">
			<button id="erase-button">Effacer</button>
		</div> -->

		<div id="graph"></div>

		<script src="viz.js"></script>
		<script src="full.render.js"></script>
		<script src="BST.js"></script>
	</body>
</html></textarea>

                <p> Fichier JavaScript.</p>

<textarea class="editor mt" spellcheck="false">
class Node{
    constructor(data, left = null, right = null) {
        this.data = data;
        this.left = left;
        this.right = right;
    }
}

class BST{
    constructor(){
        this.root = null;
        this.parents = {};
        this.nodes = {};
    }
    
    /* Convert the adjacency matrix to dot language in order to use viz.js */
    _toDotLanguage() {
        let graph = [];

        if (this.root.left == null && this.root.right == null) {
            graph.push(this.root.data);
            return `digraph { ${graph.join(' ')} }`;
        }

        let queue = [this.root];
        while (queue.length > 0) {
            let current_node = queue.pop();
            if (current_node.left != null) {
                graph.push(`${current_node.data} -> ${current_node.left.data}`);
                queue.push(current_node.left);
            }
            if (current_node.right != null) {
                graph.push(`${current_node.data} -> ${current_node.right.data}`);
                queue.push(current_node.right);
            }
        }
        return `digraph { ${graph.join(' ')} }`;
    }

    add(data) {
        if (this.root == null) {
            this.root = new Node(data);
            return;
        }
        let queue = [this.root];
        while (queue.length > 0) {
            let current_node = queue.pop();
            if (data < current_node.data) {
                if (current_node.left == null) {
                    this.nodes[data] = new Node(data);
                    current_node.left = this.nodes[data];
                    this.parents[data] = current_node.data;
                    return;
                }
                queue.push(current_node.left);
            } else if (data > current_node.data) {
                if (current_node.right == null) {
                    this.nodes[data] = new Node(data);
                    current_node.right = this.nodes[data];
                    this.parents[data] = current_node.data;
                    return;
                }
                queue.push(current_node.right);
            }
        }
    }

    findMin(root_node = this.root) {
        if (this.root == null) { return ''; }

        let queue = [root_node];
        while (queue.length > 0) {
            let current_node = queue.pop();
            if (current_node.left == null) {                            
                return current_node.data;
            }
            queue.push(current_node.left);
        }
    }

    findMax(root_node = this.root) {
        if (this.root == null) { return ''; }
        
        let queue = [root_node];
        while (queue.length > 0) {
            let current_node = queue.pop();
            if (current_node.right == null) {
                return current_node.data;
            }
            queue.push(current_node.right);
        }
    }

    remove(data) {
        this.root = this._removeNode(this.root, data);
    }

    _removeNode(node, data) {
        console.log('----------------');                    
        if (node == null) return null;

        if (data < node.data) {
            node.left = this._removeNode(node.left, data);
            return node;
        } else if (data > node.data) {
            node.right = this._removeNode(node.right, data);
            return node;
        } else {
            // Cas 1 : feuille
            if (node.left === null && node.right === null) {
                return null;
            }

            // Cas 2 : un seul enfant
            if (node.left === null) return node.right;
            if (node.right === null) return node.left;

            // Cas 3 : deux enfants
            // ‚Üí On cherche le plus petit √©l√©ment du sous-arbre droit (successeur)
            let minRight = node.right;
            while (minRight.left !== null) {
                minRight = minRight.left;
            }
            node.data = minRight.data;
            node.right = this._removeNode(node.right, minRight.data);
            return node;
        }
    }

    update(){
        let minimum = document.querySelector('#minimum');
        let maximum = document.querySelector('#maximum');
        minimum.textContent = this.findMin();
        maximum.textContent = this.findMax();
    }

    display() {
        let graph_tag = document.querySelector('#graph');
        graph_tag.textContent = '';                    

        if (this.root == null) { return; }

        let viz = new Viz();
        viz.renderSVGElement(this._toDotLanguage())
        .then(function(element) {
            graph_tag.appendChild(element);
        })
        .catch(error => {
            // Possibly display the error
            console.error(error);
        });
    }
}


let bst = new BST();
bst.add(12);
bst.add(14);
bst.add(13);
bst.add(15);
bst.display();

let add_btn = document.querySelector('#add-button');
let add_input = document.querySelector('#add');
add_btn.addEventListener('click', evt => {
    if (isNaN(Number(add_input.value))) return;
    bst.add(Number(add_input.value));
    bst.update();
    bst.display();
    console.log('Added');
});

let erase_btn = document.querySelector('#erase-button');
let erase_input = document.querySelector('#erase');
erase_btn.addEventListener('click', evt => {
    if (isNaN(Number(erase_input.value))) return;
    bst.remove(Number(erase_input.value));
    bst.update();
    bst.display();
    console.log('Erased');
});
</textarea>
            </div>

        </div>
    </div>


<!--
88888888888                              888          888            
    888                                  888          888            
    888                                  888          888            
    888   .d88b.  88888b.d88b.  88888b.  888  8888b.  888888 .d88b.  
    888  d8P  Y8b 888 "888 "88b 888 "88b 888     "88b 888   d8P  Y8b 
    888  88888888 888  888  888 888  888 888 .d888888 888   88888888 
    888  Y8b.     888  888  888 888 d88P 888 888  888 Y88b. Y8b.     
    888   "Y8888  888  888  888 88888P"  888 "Y888888  "Y888 "Y8888  
                                888                                  
                                888                                  
                                888                                  
-->

    <template id="cell-template">
        <section class="cell">
            <header>
                <div class="cell-title">
                    <span class="badge">
                        <span class="dot"></span>
                        <span class="title-text">JavaScript</span>
                    </span>
                </div>
                <div class="cell-actions">
                    <button class="btn run">
                        <span class="icon">‚ñ∂</span>
                        <span class="label">Ex√©cuter</span>
                    </button>
                    <button class="btn reset">
                        <span class="icon">‚ü≥</span>
                        <span class="label">R√©initialiser</span>
                    </button>

                    <button class="btn clear">
                        <span class="icon">üßπ</span>
                        <span class="label">Effacer</span>
                    </button>
                </div>
            </header>
            <textarea class="editor" spellcheck="false"></textarea>
            <div class="output" aria-live="polite"></div>
        </section>
    </template>


<!--
 .d8888b.                   d8b          888    
d88P  Y88b                  Y8P          888    
Y88b.                                    888    
 "Y888b.    .d8888b 888d888 888 88888b.  888888 
    "Y88b. d88P"    888P"   888 888 "88b 888    
      "888 888      888     888 888  888 888    
Y88b  d88P Y88b.    888     888 888 d88P Y88b.  
 "Y8888P"   "Y8888P 888     888 88888P"   "Y888 
                                888             
                                888             
                                888             
-->

    <script src="../js/main.js"></script>

    <script>
        /* ==== Add cells ==== */
   
    // addCell('cells00', '', `

    // `);


/*        
    addCell('cells00', '', `

    `);
*/

    </script>
</body>
</html>